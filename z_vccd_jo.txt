z_vccd_jo1:--z_vccd_jo1
declare @t_bnoa nvarchar(50)
declare @t_enoa nvarchar(50)
set @t_bnoa = case when '#non' = [2] then '' else [2] end
set @t_enoa = case when '#non' = [3] then CHAR(255) else [3] end

declare @tmp table(
	gno nvarchar(1),
	noa nvarchar(50),
	cno nvarchar(50),
	cust nvarchar(100),
	addr nvarchar(max),
	vdate nvarchar(10),
	car nvarchar(50),
	cano nvarchar(50),
	tranmoney float,
	memo nvarchar(max),
	ordeno nvarchar(50),
	productno nvarchar(100),
	product nvarchar(max),
	store nvarchar(50),
	mount float,
	unit nvarchar(50),
	price float,
	total float,
	bmemo nvarchar(max)
)
insert into @tmp
select '0',a.noa,a.custno,a.comp,a.addr,a.vdate,a.car,a.carno,a.tranmoney,a.memo,b.ordeno,productno
		,b.product,store,b.inmount,unit,b.price,b.total,b.memo
from view_vccd a left join view_vccds b on a.noa=b.noa
where (a.noa between @t_bnoa and @t_enoa)

insert into @tmp(gno,noa,mount,total)
select '1',noa,SUM(mount),SUM(total)
from @tmp
group by noa

select 
dbo.getComma(mount,0)mount
,dbo.getComma(price,-1)price
,dbo.getComma(total,0)total
,* from @tmp
;