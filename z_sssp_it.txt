z_sssp_it1:--z_sssp_it1
declare @t_xmon nvarchar(20)
declare @t_xkind nvarchar(20)
declare @t_sssno nvarchar(20)
set @t_xmon = case when '#non' = [2] then '' else [2] end
set @t_xkind = case when '#non' = [3] then '' else [3] end
set @t_sssno = case when '#non' = '[1]' then '' else '[1]' end
--**************************************************************
declare @tmp table( 
	gno nvarchar(1), 
	noa nvarchar(30), 
	noq nvarchar(20), 
	sno nvarchar(20), 
	namea nvarchar(50), 
	indate nvarchar(10), 
	ft_date nvarchar(10), 
	moneys int, 
	pubmoney int, 
	bo_admins int, 
	bo_traffic int, 
	bo_special int, 
	bo_oth int, 
	total1 int, 
	ch_labor1 int, 
	ch_labor2 int, 
	ich_health int, 
	mi_sailday int, 
	mi_total int, 
	bo_full int, 
	tax_other int, 
	total2 int, 
	addh2_1 float, 
	addh2_2 float, 
	addmoney int, 
	tax_other2 int, 
	total3 int, 
	borrow int, 
	ch_labor int, 
	chla_comp int, 
	chla_self int, 
	hplus float,
	lopofee int, 
	tax int, 
	tax5 int, 
	welfare int, 
	ch_health int, 
	total4 int, 
	total5 int, 
	monkind nvarchar(20), 
	mon nvarchar(10), 
	minus int, 
	plus int, 
	plusitem nvarchar(max), 
	minusitem nvarchar(max), 
	plusmemo nvarchar(max), 
	minusmemo nvarchar(max), 
	bomemo nvarchar(max) 
) 
insert into @tmp 
select '0' gno, a.noa,b.noq,b.sno,b.namea,c.indate,c.ft_date,b.money,b.pubmoney,b.bo_admin,b.bo_traffic,b.bo_special, 
b.bo_oth,b.total1,b.ch_labor1,b.ch_labor2,b.ch_health_insure,b.mi_saliday,b.mi_total,b.bo_full,b.tax_other,b.total2,b.addh2_1,b.addh2_2, 
b.addmoney,b.tax_other2,b.total3,b.borrow,b.ch_labor,b.ch_labor_comp,b.ch_labor_self,isnull(b.hplus2,0),b.lodging_power_fee,b.tax,b.tax5, 
b.welfare,b.ch_health,b.total4,b.total5,a.monkind,a.mon,isnull(b.minus,0),isnull(b.plus,0), 
(select plusitem from (select sssno,STUFF((select ','+T4.item from salchg T2 left join salchgitem T4 on T2.plusitem=T4.noa where T2.sssno=T1.sssno and mon=@t_xmon FOR XML PATH('')),1,1,'')plusitem from salchg T1 where mon=@t_xmon group by sssno) T3 where b.sno=sssno), 
(select minusitem from (select sssno,STUFF((select ','+T4.item from salchg T2 left join salchgitem T4 on T2.minusitem=T4.noa where T2.sssno=T1.sssno and mon=@t_xmon FOR XML PATH('')),1,1,'')minusitem from salchg T1 where mon=@t_xmon group by sssno) T3 where b.sno=sssno), 
(select plusmemo from (select sssno,STUFF((select ','+T2.memo from salchg T2 where plusitem!='' and minusitem='' and T2.sssno=T1.sssno and mon=@t_xmon FOR XML PATH('')),1,1,'')plusmemo from salchg T1 where mon=@t_xmon group by sssno) T3 where b.sno=sssno), 
(select minusmemo from (select sssno,STUFF((select ','+T2.memo from salchg T2 where plusitem='' and minusitem!='' and T2.sssno=T1.sssno and mon=@t_xmon FOR XML PATH('')),1,1,'')minusmemo from salchg T1 where mon=@t_xmon group by sssno) T3 where b.sno=sssno), 
(select top 1 memo from saladjust where noa=b.sno order by noq desc) 
from salary a 
left join salarys b on a.noa = b.noa 
left join sss c on b.sno = c.noa 
where (LEN(@t_xmon) = 0 or @t_xmon = a.mon) and 
(LEN(@t_xkind) = 0 or @t_xkind = a.monkind) and 
(b.sno = @t_sssno) and 
(a.person = '本國') 

select gno,noa,noq,sno,namea,indate,ft_date, (case when plusitem!='' then '('+plusitem+')' else '' end) plusitem, (case when minusitem!='' then '('+minusitem+')' else '' end) minusitem, (case when bomemo!='' then '('+bomemo+')' else '' end) bomemo, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,moneys),1)),4,12)) moneys, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,pubmoney),1)),4,12)) pubm, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bo_admins),1)),4,12))boad, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bo_traffic),1)),4,12)) botr, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bo_special),1)),4,12)) bosp, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bo_oth),1)),4,12)) boot, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total1),1)),4,12)) total1, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,ch_labor1),1)),4,12)) chla, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,ch_labor2),1)),4,12)) chlb, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,ich_health),1)),4,12)) ichh, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,mi_sailday),1)),4,12)) misa, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,mi_total),1)),4,12)) mito, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bo_full),1)),4,12)) bofu, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,tax_other),1)),4,12)) taxo, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total2),1)),4,12)) total2, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,addh2_1),1)),4,12)) ad21, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,addh2_2),1)),4,12)) ad22, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,addmoney),1)),4,12)) addm, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,tax_other2),1)),4,12)) taxt, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total3),1)),4,12)) total3, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,borrow),1)),4,12)) bow, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,ch_labor),1)),4,12)) chlo, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,chla_comp),1)),4,12)) chlc, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,chla_self),1)),4,12)) chls, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,hplus),1)),4,12)) hplus,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,lopofee),1)),4,12)) lopo, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,tax),1)),4,12))tax, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,tax5),1)),4,12)) tax5, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,welfare),1)),4,12)) welfare, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,ch_health),1)),4,12)) chhe, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total4),1)),4,12)) total4, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total5),1)),4,12)) total5,mon,monkind, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,minus),1)),4,12)) minus, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,plus),1)),4,12)) plus, 
(select worker from salary where @t_xmon = mon and @t_xkind = monkind and person = '本國') worker 
,plusmemo,minusmemo
from @tmp;
--------------***********************************----------------------
z_sssp_it2:--z_sssp_it2
declare @year nvarchar(10)
declare @t_sssno nvarchar(20)
set @year = case when '#non'=[2] then '' else [2] end
set @t_sssno = case when '#non'='[1]' then '' else '[1]' end

------------------------------------------------------今年基本年終資料
declare @tmp table( 
	gno nvarchar(1), 
	partno nvarchar(20), 
	part nvarchar(50), 
	sssno nvarchar(20), 
	namea nvarchar(50),
	total1 float,
	total2 float, 
	total3 float,
	total4 float, 
	total5 float, 
	money float,
	rate float, 
	tax float, 
	total6 float,
	total7 float, 
	total8 float, 
	first float, 
	second float, 
	memo2 nvarchar(MAX) 
) 
insert into @tmp 
	select
		'0' gno,b.partno,b.part,b.sssno,b.namea,b.total1,b.total2,b.total3,b.total4,b.total5,b.money
		,b.taxrate,b.tax,b.total6,b.total7,b.total8,b.firstmoney,b.secondmoney,b.memo2 
	from salaward a left join salawards b on a.noa=b.noa 
	where (b.sssno = @t_sssno) 
	and [year]=@year

select
	gno,partno,part,sssno,namea,
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total1),1)),4,12)) total1, 
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total2),1)),4,12)) total2, 
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total3),1)),4,12)) total3, 
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total4),1)),4,12)) total4, 
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total5),1)),4,12)) total5, 
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,money),1)),4,12)) money, 
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,rate),1)),0,12)) rate,
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,tax),1)),4,12)) tax, 
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total6),1)),4,12)) total6, 
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total7),1)),4,12)) total7, 
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total8),1)),4,12)) total8, 
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,first),1)),4,12)) first, 
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,second),1)),4,12)) second, 
	memo2,(select top 1 worker from salaward where [year]=@year) worker
from @tmp order by sssno;