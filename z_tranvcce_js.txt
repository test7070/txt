declare @tmp table(
	gno nvarchar(1),
	storeno nvarchar(50),
	store nvarchar(100),
	ordeno nvarchar(50),
	noq nvarchar(50),
	custno nvarchar(50),
	comp nvarchar(100),
	productno nvarchar(50),
	product nvarchar(100),
	omount float,
	cmount float,
	smount float,
	ncmount float,
	nsmount float,
	lengthb float,
	width float,
	volume float,
	mins float,
	chk1 nvarchar(1),
	addrno nvarchar(50),
	addr nvarchar(100),
	addrness nvarchar(max)
)
insert @tmp
select '9',endaddrno,endaddr,ordeno,no2,custno,cust,b.productno,b.product,isnull(c.mount,0)
,case when b.chk1='1' then b.mount else 0 end,case when b.chk2='1' then b.mount else 0 end
,isnull(c.mount,0)-case when b.chk1='1' then b.mount else 0 end,''
,b.lengthb
,b.width,b.volume,mins,case when isassign='1' then 'V' else '' end,b.addrno,b.addr,b.address
from view_tranvcce a left join view_tranvcces b on a.noa=b.noa
left join view_tranordes c on b.ordeno=c.noa and b.no2=c.noq

update @tmp
set nsmount= case when isnull(ncmount,0)!=0 then ncmount else cmount-smount end

insert @tmp
select '0',storeno,store,ordeno,'',custno,comp,productno,product,sum(omount),sum(cmount),sum(smount)
,sum(ncmount),sum(nsmount),lengthb,width,volume,mins,chk1,addrno,addr,addrness
from @tmp
group by storeno,store,ordeno,chk1,custno,comp,productno,product,lengthb,width,volume,mins,addrno,addr,addrness

delete @tmp where gno='9'

select * from @tmp
