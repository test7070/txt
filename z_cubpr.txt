z_cubpr01:--z_cubpr01
	SET QUOTED_IDENTIFIER OFF
	declare @t_bdate nvarchar(50)
	declare @t_edate nvarchar(50)
	declare @t_bcustno nvarchar(50)
	declare @t_ecustno nvarchar(50)
	declare @t_bproductno nvarchar(10)
	declare @t_eproductno nvarchar(10)
	declare @t_bnoq nvarchar(10)
	declare @t_enoq nvarchar(10)
	declare @t_btggno nvarchar(10)
	declare @t_etggno nvarchar(10)

	set @t_bdate = case when '#non'=[1] then '' else [1] end
	set @t_edate = case when '#non'=[2] then char(255) else [2] end
	set @t_bcustno = case when '#non'=[3] then '' else [3] end
	set @t_ecustno = case when '#non'=[4] then char(255) else [4] end
	set @t_bproductno = case when '#non'=[5] then '' else [5] end
	set @t_eproductno = case when '#non'=[6] then char(255) else [6] end
	set @t_bnoq = case when '#non'=[7] then '' else [7] end
	set @t_enoq = case when '#non'=[8] then char(255) else [8] end
	set @t_btggno = case when '#non'=[9] then '' else [9] end
	set @t_etggno = case when '#non'=[10] then char(255) else [10] end
	
	
	declare @tmp table(
		gno nvarchar(1),
		noa nvarchar(20),
		noq nvarchar(20),
		datea nvarchar(10),
		cdate nvarchar(10),--預交日期
		custno nvarchar(50),
		comp nvarchar(100),
		tggno nvarchar(50),
		tgg nvarchar(100),
		process nvarchar(50),
		productno nvarchar(50),
		product nvarchar(100),
		pproductno nvarchar(50),--生產件號
		spec nvarchar(50),
		memo2 nvarchar(max),
		enda nvarchar(10),
		fdate nvarchar(10),--完工日
		ordeno nvarchar(50),
		cmount float,
		cprice float,
		mount float,
		unit nvarchar(20),
		price float,
		mo float,
		w02 float,
		w01 float
	)
	
	insert into @tmp
	select '0',b.noa,b.noq,a.datea,a.bdate,a.custno,a.comp,b.tggno,b.tgg,b.process,
			a.productno,a.product,b.productno,a.spec,a.memo2,b.enda,b.datea,b.ordeno,a.mount,a.price
			,b.mount,b.unit,b.price,b.mo,b.w02,b.w01
	from view_cub a left join view_cubs b on a.noa=b.noa
	where
	b.enda='0'
	and a.datea between @t_bdate and @t_edate
	and b.noq  between  @t_bnoq and @t_enoq 
	and a.custno  between  @t_bcustno and @t_ecustno 
	and b.tggno  between  @t_btggno and @t_etggno 
	and a.productno  between  @t_bproductno and @t_eproductno
	
	if ((select count(*) from @tmp)>0)
	begin
		insert into @tmp(gno,custno)
		select '1',custno
		from @tmp
		group by custno
	end
	

	
	
	select 
	dbo.getComma(cmount,2)cmount,
	dbo.getComma(cprice,2)cprice,
	dbo.getComma(mount,2)mount,
	dbo.getComma(price,2)price,
	* from @tmp
;
	