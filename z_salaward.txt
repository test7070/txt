z_salaward1:--z_salaward1
declare @year nvarchar(10)
declare @before_year nvarchar(10)
declare @t_bsssno nvarchar(20)
declare @t_esssno nvarchar(20)
declare @t_bpartno nvarchar(20)
declare @t_epartno nvarchar(20)

set @year = case when '#non'=[2] then '' else [2] end
set @before_year = CAST(@year as int)-1
set @t_bsssno = case when '#non'=[3] then '' else [3] end
set @t_esssno = case when '#non'=[4] then char(255) else [4] end
set @t_bpartno = case when '#non'=[7] then '' else [7] end
set @t_epartno = case when '#non'=[8] then char(255) else [8] end

------------------------------------------------------今年基本年終資料
declare @tmp table( 
	gno nvarchar(1), 
	partno nvarchar(20), 
	part nvarchar(50), 
	senior nvarchar(20), 
	sssno nvarchar(20), 
	namea nvarchar(50), 
	indate nvarchar(10), 
	salary float, 
	boa float, 
	bot float, 
	bos float, 
	boo float, 
	total float, 
	oldmidmon float, 
	oldtotal float, 
	total6 float, 
	total5 float, 
	total7 float, 
	total8 float, 
	first float, 
	second float, 
	memo2 nvarchar(MAX) 
) 
insert into @tmp 
select '0' gno,b.partno,b.part,'' senior,b.sssno,b.namea,b.indate 
,b.salary,b.bo_traffic,b.bo_special,b.bo_admin,b.bo_oth,b.money as total,b.oldmidmon,b.oldaward 
,b.total6,b.total5,b.total7,b.total8,b.firstmoney,b.secondmoney,b.memo2 
from salaward a left join salawards b on a.noa=b.noa 
where (a.year = @year) and (typea='年終') and (b.sssno between @t_bsssno and @t_esssno) 
 and (b.partno between @t_bpartno and @t_epartno)

------------------------------------------------------------------------------------------ 
--年資 
update a
set senior = isnull((select seniority from dbo.seniority('','') where sssno=a.sssno),'')
from @tmp a
------------------------------------------------------------------------------------------- 

--插入總計 
insert into @tmp 
select '1' gno ,'999','','','','','' 
,sum(salary),sum(boa),sum(bot),sum(bos),sum(boo),sum(total),sum(oldmidmon) 
,sum(oldtotal),sum(total6),sum(total5),sum(total7),sum(total8),sum(first),sum(second),'' 
from @tmp where gno='0' 


------------------------------------- 
--插入部門小計
insert into @tmp 
select '2' gno,partno,part,'','','','' 
,sum(salary),sum(boa),sum(bot),sum(bos),sum(boo),sum(total),sum(oldmidmon) 
,sum(oldtotal),sum(total6),sum(total5),sum(total7),sum(total8),sum(first),sum(second),'' 
from @tmp where gno='0' group by partno,part

select gno,partno,part,senior,namea,indate,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,salary),1)),4,12)) salary, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bot),1)),4,12)) bot, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bos),1)),4,12)) bos, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,boa),1)),4,12)) boa, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,boo),1)),4,12)) boo, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total),1)),4,12)) total, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldmidmon),1)),4,12)) oldmidmon, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldtotal),1)),4,12)) total1, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total6),1)),4,12)) total6, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total5),1)),4,12)) total5, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total7),1)),4,12)) total7, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total8),1)),4,12)) total8, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,first),1)),4,12)) first, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,second),1)),4,12)) second, 
memo2,(select worker from salaward where (year = @year) and (typea = '年終'))worker 
from @tmp 
order by partno,gno;
--*************************************************************************************************************
z_salaward2:--z_salaward2
declare @year nvarchar(10)
declare @t_bsssno nvarchar(20)
declare @t_esssno nvarchar(20)
declare @t_bpartno nvarchar(20)
declare @t_epartno nvarchar(20)

set @year = case when '#non'=[2] then '' else [2] end
set @t_bsssno = case when '#non'=[3] then '' else [3] end
set @t_esssno = case when '#non'=[4] then char(255) else [4] end
set @t_bpartno = case when '#non'=[7] then '' else [7] end
set @t_epartno = case when '#non'=[8] then char(255) else [8] end

declare @tmp table( 
	gno nvarchar(1), 
	idno int identity(1,1),
	partno nvarchar(20), 
	part nvarchar(50), 
	sssno nvarchar(20), 
	namea nvarchar(50), 
	salary float, 
	oldmidmon float,
	oldaward float,
	adjustmoney float, 
	sugmoney float, 
	chkmoney float, 
	memo nvarchar(max),
	indate nvarchar(10),
	senior nvarchar(20)
) 
insert into @tmp 
select '0' gno,b.partno,b.part,b.sssno,b.namea,money,oldmidmon,oldaward,adjustmoney,sugmoney,chkmoney,memo2,c.indate,''
from salaward a left join salawards b on a.noa=b.noa left join sss c on b.sssno=c.noa
where (a.year = @year) and (a.typea='秋節') and (b.sssno between @t_bsssno and @t_esssno) 
 and (b.partno between @t_bpartno and @t_epartno)

--年資 
--update @tmp 
--set senior = ( 
--case when (CAST(left(indate,3) as int)=0) then '未滿一月' else ( 
--case when (@year-CAST(left(indate,3) as int)-1) >0  and (12+9-CAST(right(left(indate,6),2) as int))=12 then cast((@year-CAST(left(indate,3) as int)) as nvarchar) + ' 年 '
--when (@year-CAST(left(indate,3) as int)-1) >0 then cast((@year-CAST(left(indate,3) as int)-1) as nvarchar) + ' 年 ' else '' end + 
--case when (9-CAST(right(left(indate,6),2) as int)) >0 then cast((9-CAST(right(left(indate,6),2) as int)) as nvarchar) + ' 月' 
--when (12+9-CAST(right(left(indate,6),2) as int))=12 then ''
--else cast((12+9-CAST(right(left(indate,6),2) as int)) as nvarchar) + ' 月' end ) 
--end) 

update a
set senior = isnull((select seniority from dbo.seniority('','') where sssno=a.sssno),'')
from @tmp a

insert into @tmp 
select '1','999','','','',SUM(salary),SUM(oldmidmon),SUM(oldaward),SUM(adjustmoney), SUM(sugmoney),SUM(chkmoney),'' ,'',''
from @tmp where gno = '0'

insert into @tmp 
select '2',partno,part,'','',SUM(salary),SUM(oldmidmon),SUM(oldaward),SUM(adjustmoney), SUM(sugmoney),SUM(chkmoney),'','','' 
from @tmp where gno = '0' group by partno,part

select gno,idno,partno,part,sssno,namea,memo,indate,senior
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,salary),1)),4,12)) salary
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldmidmon),1)),4,12)) oldmidmon
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldaward),1)),4,12)) oldaward
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,adjustmoney),1)),4,12)) adjustmoney
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,sugmoney),1)),4,12)) sugmoney
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,chkmoney),1)),4,12)) chkmoney
,(select worker from salaward where (year = @year) and (typea = '秋節'))worker 
from @tmp order by partno,gno;
----------------------------------------------------------------------------------
z_salaward3:--z_salaward3
declare @t_year nvarchar(20)
declare @t_bsssno nvarchar(20)
declare @t_esssno nvarchar(20)
set @t_year = case when '#non' = [2] then '' else [2] end
set @t_bsssno = case when '#non' = [3] then '' else [3] end
set @t_esssno = case when '#non' = [4] then CHAR(255) else [4] end
--刪除暫存資料庫
IF OBJECT_ID('tempdb..#tmp')is not null
BEGIN
       drop table #tmp
END
SET QUOTED_IDENTIFIER OFF
declare @tmpa table( 
idno int identity(1,1),
sssno nvarchar(20), 
namea nvarchar(50), 
total6 float, 
oldmidmon float, 
total5 float,
total7 float, 
firstmoney float, 
secondmoney float
)

create table #tmp( 
gno nvarchar(1), 
sssno1 nvarchar(20), 
namea1 nvarchar(50), 
total61 float, 
oldmidmon1 float, 
total51 float,
total71 float, 
firstmoney1 float, 
secondmoney1 float, 
sssno2 nvarchar(20), 
namea2 nvarchar(50), 
total62 float, 
oldmidmon2 float, 
total52 float,
total72 float, 
firstmoney2 float, 
secondmoney2 float, 
sssno3 nvarchar(20), 
namea3 nvarchar(50), 
total63 float, 
oldmidmon3 float, 
total53 float,
total73 float, 
firstmoney3 float, 
secondmoney3 float, 
sssno4 nvarchar(20), 
namea4 nvarchar(50), 
total64 float, 
oldmidmon4 float, 
total54 float,
total74 float, 
firstmoney4 float, 
secondmoney4 float, 
sssno5 nvarchar(20), 
namea5 nvarchar(50), 
total65 float, 
oldmidmon5 float, 
total55 float,
total75 float, 
firstmoney5 float, 
secondmoney5 float, 
sssno6 nvarchar(20), 
namea6 nvarchar(50), 
total66 float, 
oldmidmon6 float, 
total56 float,
total76 float, 
firstmoney6 float, 
secondmoney6 float, 
sssno7 nvarchar(20), 
namea7 nvarchar(50), 
total67 float, 
oldmidmon7 float, 
total57 float,
total77 float, 
firstmoney7 float, 
secondmoney7 float,
sssno0 nvarchar(20), 
namea0 nvarchar(50), 
total60 float, 
oldmidmon0 float, 
total50 float,
total70 float, 
firstmoney0 float, 
secondmoney0 float,
page int
) 

insert into @tmpa
select b.sssno,b.namea,b.total6,b.oldmidmon,b.total5,b.total7,b.firstmoney,b.secondmoney
from salaward a left join salawards b on a.noa=b.noa
where a.year=@t_year and a.typea='年終' and (b.sssno between @t_bsssno and @t_esssno) 

declare @idno int
declare @sssno nvarchar(20) 
declare @namea nvarchar(50)
declare @total6 float
declare @oldmidmon float
declare @total5 float
declare @total7 float
declare @firstmoney float
declare @secondmoney float

declare @page int
set @page=0
declare @cmd nvarchar(max)
declare cursor_table cursor for
	select * from @tmpa
	open cursor_table
	fetch next from cursor_table
	into @idno,@sssno,@namea,@total6,@oldmidmon,@total5,@total7,@firstmoney,@secondmoney
	while(@@FETCH_STATUS <> -1)
	begin
		if(@idno%8=1)
		begin
			set @page=@page+1
			INSERT INTO #tmp (gno,sssno1,namea1,total61,oldmidmon1,total51,total71,firstmoney1,secondmoney1,page)
			select '0',@sssno,@namea,@total6,@oldmidmon,@total5,@total7,@firstmoney,@secondmoney,@page
		end
		else
		begin
		set @cmd='update #tmp set sssno'+cast(@idno%8 as nvarchar(2))+' ='''+@sssno+''',namea'+cast(@idno%8 as nvarchar(2))+' ='''+@namea+''',total6'+cast(@idno%8 as nvarchar(2))+' ='+cast(@total6 as nvarchar(20))+',oldmidmon'+cast(@idno%8 as nvarchar(2))+' ='+cast(@oldmidmon as nvarchar(20))+',total5'+cast(@idno%8 as nvarchar(2))+' ='+cast(@total5 as nvarchar(20))+',total7'+cast(@idno%8 as nvarchar(2))+' ='+cast(@total7 as nvarchar(20))+',firstmoney'+cast(@idno%8 as nvarchar(2))+' ='+cast(@firstmoney as nvarchar(20))+',secondmoney'+cast(@idno%8 as nvarchar(2))+' ='+cast(@secondmoney as nvarchar(20))
		set @cmd=@cmd+' where page='+cast(@page as nvarchar(20))
		EXECUTE sp_executesql @cmd
		end
		
		fetch next from cursor_table
		into @idno,@sssno,@namea,@total6,@oldmidmon,@total5,@total7,@firstmoney,@secondmoney
	end
close cursor_table
deallocate cursor_table

select gno,sssno1,namea1,sssno2,namea2,sssno3,namea3,sssno4,namea4,sssno5,namea5,sssno6,namea6,sssno7,namea7,sssno0,namea0
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total61),1)),4,12)) total61
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldmidmon1),1)),4,12)) oldmidmon1
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total51),1)),4,12)) total51
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total71),1)),4,12)) total71
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,firstmoney1),1)),4,12)) firstmoney1
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,secondmoney1),1)),4,12)) secondmoney1

,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total62),1)),4,12)) total62
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldmidmon2),1)),4,12)) oldmidmon2
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total52),1)),4,12)) total52
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total72),1)),4,12)) total72
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,firstmoney2),1)),4,12)) firstmoney2
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,secondmoney2),1)),4,12)) secondmoney2

,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total63),1)),4,12)) total63
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldmidmon3),1)),4,12)) oldmidmon3
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total53),1)),4,12)) total53
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total73),1)),4,12)) total73
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,firstmoney3),1)),4,12)) firstmoney3
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,secondmoney3),1)),4,12)) secondmoney3

,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total64),1)),4,12)) total64
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldmidmon4),1)),4,12)) oldmidmon4
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total54),1)),4,12)) total54
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total74),1)),4,12)) total74
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,firstmoney4),1)),4,12)) firstmoney4
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,secondmoney4),1)),4,12)) secondmoney4

,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total65),1)),4,12)) total65
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldmidmon5),1)),4,12)) oldmidmon5
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total55),1)),4,12)) total55
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total75),1)),4,12)) total75
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,firstmoney5),1)),4,12)) firstmoney5
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,secondmoney5),1)),4,12)) secondmoney5

,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total66),1)),4,12)) total66
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldmidmon6),1)),4,12)) oldmidmon6
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total56),1)),4,12)) total56
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total76),1)),4,12)) total76
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,firstmoney6),1)),4,12)) firstmoney6
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,secondmoney6),1)),4,12)) secondmoney6

,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total67),1)),4,12)) total67
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldmidmon7),1)),4,12)) oldmidmon7
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total57),1)),4,12)) total57
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total77),1)),4,12)) total77
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,firstmoney7),1)),4,12)) firstmoney7
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,secondmoney7),1)),4,12)) secondmoney7

,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total60),1)),4,12)) total60
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldmidmon0),1)),4,12)) oldmidmon0
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total50),1)),4,12)) total50
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total70),1)),4,12)) total70
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,firstmoney0),1)),4,12)) firstmoney0
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,secondmoney0),1)),4,12)) secondmoney0

from #tmp

--刪除暫存資料庫
IF OBJECT_ID('tempdb..#tmp')is not null
BEGIN
       drop table #tmp
END;
-------------------------------------------------------------------------------------------------
z_salaward4:--z_salaward4 
declare @year nvarchar(10) 
declare @before_year nvarchar(10) 
declare @t_bsssno nvarchar(20) 
declare @t_esssno nvarchar(20) 
declare @t_bpartno nvarchar(20)
declare @t_epartno nvarchar(20)

set @year = case when '#non'=[2] then '' else [2] end
set @before_year = CAST(@year as int)-1
set @t_bsssno = case when '#non'=[3] then '' else [3] end
set @t_esssno = case when '#non'=[4] then char(255) else [4] end
set @t_bpartno = case when '#non'=[7] then '' else [7] end
set @t_epartno = case when '#non'=[8] then char(255) else [8] end

------------------------------------------------------今年基本年終資料 
declare @tmp table( 
	gno nvarchar(1), 
	partno nvarchar(20),
	part nvarchar(50), 
	senior nvarchar(20), 
	sssno nvarchar(20), 
	namea nvarchar(50), 
	indate nvarchar(10), 
	salary float, 
	boa float, 
	bot float, 
	bos float, 
	boo float, 
	total float, 
	oldmidmon float, 
	oldtotal float, 
	total6 float, 
	total5 float, 
	total7 float, 
	total8 float, 
	first float, 
	second float, 
	memo2 nvarchar(MAX), 
	total1 float, 
	late float, 
	lea float, 
	person float, 
	sick float, 
	leave float, 
	marry float, 
	bere float, 
	total2 float, 
	great float, 
	minor float, 
	com float, 
	major float, 
	pecca float, 
	repri float, 
	total3 float, 
	total4 float, 
	memo nvarchar(200) 
) 
insert into @tmp 
select '0' gno ,b.partno,b.part,'' senior,b.sssno,b.namea,b.indate 
,b.salary,b.bo_traffic,b.bo_special,b.bo_admin,b.bo_oth,b.money as total,b.oldmidmon,b.oldaward 
,b.total6,b.total5,b.total7,b.total8,b.firstmoney,b.secondmoney,b.memo2,b.total1,b.late,b.leaveearly,b.person, 
b.sick,b.leave,b.marriageleave,b.bereavementleave,b.total2,b.greatmeriy,b.minormerits,b.commend,b.majordemerits, 
b.peccadillo,b.reprimand,b.total3,b.total4,b.memo 
from salaward a left join salawards b on a.noa=b.noa 
where (a.year = @year) and (typea='年終') and (b.sssno between @t_bsssno and @t_esssno) 
and (b.partno between @t_bpartno and @t_epartno) 

------------------------------------------------------------------------------------------ 
--年資 
update a
set senior = isnull((select seniority from dbo.seniority('','') where sssno=a.sssno),'')
from @tmp a
------------------------------------------------------------------------------------------- 

--插入總計 
insert into @tmp 
select '1' gno ,'999','','','','','' 
,sum(salary),sum(bot),sum(bos),sum(boa),sum(boo),sum(total),sum(oldmidmon) 
,sum(oldtotal),sum(total6),sum(total5),sum(total7),sum(total8),sum(first),sum(second),''
,sum(total1),sum(late),sum(lea),sum(person),sum(sick),sum(leave),sum(marry),sum(bere)
,sum(total2),sum(great),sum(minor),sum(com),sum(major),sum(pecca),sum(repri),sum(total3),sum(total4),'' 
from @tmp where gno='0' 

------------------------------------- 
--插入部門小計
insert into @tmp 
select '2' gno,partno,part,'','','','' 
,sum(salary),sum(bot),sum(bos),sum(boa),sum(boo),sum(total),sum(oldmidmon) 
,sum(oldtotal),sum(total6),sum(total5),sum(total7),sum(total8),sum(first),sum(second),''
,sum(total1),sum(late),sum(lea),sum(person),sum(sick),sum(leave),sum(marry),sum(bere)
,sum(total2),sum(great),sum(minor),sum(com),sum(major),sum(pecca),sum(repri),sum(total3),sum(total4),'' 
from @tmp where gno='0' group by partno,part

------------------------------------- 
select gno,partno,part,senior,namea,indate,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,salary),1)),4,12)) salary, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bot),1)),4,12)) bot, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bos),1)),4,12)) bos, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,boa),1)),4,12)) boa, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,boo),1)),4,12)) boo, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total),1)),4,12)) total, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldmidmon),1)),4,12)) oldmidmon, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldtotal),1)),4,12)) total9, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total6),1)),4,12)) total6, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total5),1)),4,12)) total5, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total7),1)),4,12)) total7, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total8),1)),4,12)) total8, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,first),1)),4,12)) first, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,second),1)),4,12)) second, 
memo2,total1,late,lea,person,sick,leave,marry,bere,total2,great,minor,com,major,pecca,repri,total3,total4,memo 
,(select worker from salaward where (year = @year) and (typea = '年終'))worker 
from @tmp
order by partno,gno;

-------------------------------------------------------------------------------------------------
z_salaward5:--z_salaward5

declare @t_year nvarchar(10) 
set @t_year = case when '#non'=[2] then '' else [2] end

declare @tmp table( 
	gno nvarchar(1), 
	partno nvarchar(20), 
	part nvarchar(50), 
	total5 float, 
	total6 float, 
	total7 float, 
	total8 float, 
	firstmoney float,
	secondmoney float
) 

insert @tmp
select '0',b.partno,MAX(b.part),SUM(b.total5),SUM(b.total6),SUM(b.total7),SUM(b.total8),SUM(b.firstmoney),SUM(b.secondmoney)
from salaward a left join salawards b on a.noa = b.noa 
where a.year=@t_year and a.typea='年終'
group by b.partno

if((select count(*) from @tmp)>0)
begin
	insert @tmp
	select '1',CHAR(255),CHAR(255),SUM(total5),SUM(total6),SUM(total7),SUM(total8),SUM(firstmoney),SUM(secondmoney)
	from @tmp 
end

select gno,partno,part, 
dbo.getComma(total5,0)total5,
dbo.getComma(total6,0)total6,
dbo.getComma(total7,0)total7,
dbo.getComma(total8,0)total8,
dbo.getComma(firstmoney,0)firstmoney,
dbo.getComma(secondmoney,0)secondmoney,
(select worker from salaward where year = @t_year and typea='年終') worker 
from @tmp order by gno,partno
;
-------------------------------------------
z_salaward6:--z_salaward6
declare @year nvarchar(10) 
declare @before_year nvarchar(10) 
declare @t_bsssno nvarchar(20) 
declare @t_esssno nvarchar(20) 

set @year = case when '#non'=[2] then '' else [2] end
set @before_year = CAST(@year as int)-1
set @t_bsssno = case when '#non'=[3] then '' else [3] end
set @t_esssno = case when '#non'=[4] then char(255) else [4] end


------------------------------------------------------今年基本年終資料 
declare @tmp table( 
gno nvarchar(1), 
part nvarchar(50), 
senior nvarchar(20), 
sssno nvarchar(20), 
namea nvarchar(50), 
indate nvarchar(10), 
salary float, 
boa float, 
bot float, 
bos float, 
boo float, 
total float, 
oldmidmon float, 
oldtotal float, 
total6 float, 
total5 float, 
total7 float, 
total8 float, 
first float, 
second float, 
memo2 nvarchar(MAX),
total1 float,
late float,
lea float,
person float,
sick float,
leave float,
marry float,
bere float,
total2 float,
great float,
minor float,
com float,
major float,
pecca float,
repri float,
total3 float,
total4 float,
memo nvarchar(200)
) 
insert into @tmp 
select '0' gno ,b.part,'' senior,b.sssno,b.namea,b.indate 
,b.salary,b.bo_traffic,b.bo_special,b.bo_admin,b.bo_oth,b.money as total,b.oldmidmon,b.oldaward 
,b.total6,b.total5,b.total7,b.total8,b.firstmoney,b.secondmoney,b.memo2,b.total1,b.late,b.leaveearly,b.person,
b.sick,b.leave,b.marriageleave,b.bereavementleave,b.total2,b.greatmeriy,b.minormerits,b.commend,b.majordemerits,
b.peccadillo,b.reprimand,b.total3,b.total4,b.memo
from salaward a left join salawards b on a.noa=b.noa 
where (a.year = @year) and (typea='年終') and (b.sssno between @t_bsssno and @t_esssno) 

------------------------------------------------------------------------------------------ 
--年資 
update a
set senior = isnull((select seniority from dbo.seniority('','') where sssno=a.sssno),'')
from @tmp a
------------------------------------------------------------------------------------------- 

--插入總計 
--insert into @tmp 
--select '1' gno ,'','','','','' 
--,sum(salary),sum(bot),sum(bos),sum(boa),sum(boo),sum(total),sum(oldmidmon) 
--,sum(oldtotal),sum(total6),sum(total5),sum(total7),sum(total8),sum(first),sum(second),'',0,0,0,0,
--0,0,0,0,0,0,0,0,0,0,0,0,0,'' 
--from @tmp where gno='0' 


------------------------------------- 
select gno,part,senior,namea, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,salary),1)),4,12)) salary, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bot),1)),4,12)) bot, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bos),1)),4,12)) bos, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,boa),1)),4,12)) boa, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,boo),1)),4,12)) boo, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total),1)),4,12)) total, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldmidmon),1)),4,12)) oldmidmon, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldtotal),1)),4,12)) total9, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total6),1)),4,12)) total6, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total5),1)),4,12)) total5, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total7),1)),4,12)) total7, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total8),1)),4,12)) total8, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,first),1)),4,12)) first, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,second),1)),4,12)) second, 
memo2,total1,late,lea lea1,person,sick,leave lea2,marry,bere,total2,great,minor,com,major,pecca,repri,total3,total4,memo
,(select worker from salaward where (year = @year) and (typea = '年終'))worker 
from @tmp ;
-----------------------------------------------------------------------------------------------------------------------
z_salaward7:--z_salaward7
declare @t_year nvarchar(20) 
declare @t_money nvarchar(20) 
declare @t_order nvarchar(20)

set @t_year = case when '#non'=[2] then '' else [2] end
set @t_money = case when '#non' = [5] then '' else [5] end
set @t_order = case when '#non' = [6] then '' else [6] end

declare @tmp table( 
gno nvarchar(1), 
noa nvarchar(30), 
noq nvarchar(20), 
sssno nvarchar(20), 
partno nvarchar(20), 
part nvarchar(50), 
jobno nvarchar(20), 
job nvarchar(50), 
namea nvarchar(30), 
account nvarchar(20), 
total3 int,--現金 
total4 int,--匯款 
total5 int 
) 
if(@t_money='第一次')
begin
	insert into @tmp 
	select '0' gno,a.noa,b.noq,c.noa,c.partno,c.part,c.jobno,c.job,b.namea,c.account,0,0,b.firstmoney 
	from salaward a 
	left join salawards b on a.noa = b.noa 
	left join sss c on b.sssno = c.noa 
	where a.year=@t_year and a.typea = '年終'
end

if(@t_money='第二次')
begin
	insert into @tmp 
	select '0' gno,a.noa,b.noq,c.noa,c.partno,c.part,c.jobno,c.job,b.namea,c.account,0,0,b.secondmoney
	from salaward a 
	left join salawards b on a.noa = b.noa 
	left join sss c on b.sssno = c.noa 
	where a.year=@t_year and a.typea = '年終'
end

--********************************************************************************* 

insert into @tmp 
select '1' gno,'','','','','','','','','',0,0,sum(total5) 
from @tmp 

update @tmp 
set total3=(select sum(total5) from @tmp where gno='0' and account='') 
where gno='1' 
update @tmp 
set total4=(select sum(total5) from @tmp where gno='0' and account!='') 
where gno='1' 

if(@t_order='職稱') 
select gno,noq,namea,account,sssno,part,job, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total3),1)),4,12)) total3, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total4),1)),4,12)) total4, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total5),1)),4,12)) total5, 
(select worker from salaward where year=@t_year and typea = '年終') worker 
from @tmp order by gno,partno,jobno 

if(@t_order='員工編號') 
select gno,noq,namea,account,sssno,part,job, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total3),1)),4,12)) total3, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total4),1)),4,12)) total4, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total5),1)),4,12)) total5, 
(select worker from salaward where year=@t_year and typea = '年終') worker 
from @tmp order by gno,noa 

if(@t_order='帳號') 
select gno,noq,namea,account,sssno,part,job, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total3),1)),4,12)) total3, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total4),1)),4,12)) total4, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total5),1)),4,12)) total5, 
(select worker from salaward where year=@t_year and typea = '年終') worker 
from @tmp order by gno,account 

if(@t_order='金額') 
select gno,noq,namea,account,sssno,part,job, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total3),1)),4,12)) total3, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total4),1)),4,12)) total4, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total5),1)),4,12)) total5, 
(select worker from salaward where year=@t_year and typea = '年終') worker 
from @tmp order by gno,cast(total5 as int) desc;
 ------------------------------------------------------------------------------------------------------------------
 z_salaward8:--z_salaward8
declare @year nvarchar(10)
declare @t_bsssno nvarchar(20)
declare @t_esssno nvarchar(20)
declare @t_bpartno nvarchar(20)
declare @t_epartno nvarchar(20)

set @year = case when '#non'=[2] then '' else [2] end
set @t_bsssno = case when '#non'=[3] then '' else [3] end
set @t_esssno = case when '#non'=[4] then char(255) else [4] end
set @t_bpartno = case when '#non'=[7] then '' else [7] end
set @t_epartno = case when '#non'=[8] then char(255) else [8] end

declare @tmp table( 
	gno nvarchar(1), 
	idno int identity(1,1), 
	partno nvarchar(20), 
	part nvarchar(50), 
	sssno nvarchar(20), 
	namea nvarchar(50), 
	late float, 
	early float, 
	person float, 
	sick float, 
	leave float, 
	marr float, 
	bereav float, 
	great float, 
	minor float, 
	commend float, 
	majorde float, 
	peccad float, 
	repri float, 
	salary float, 
	bo_admin float, 
	bo_traffic float, 
	bo_special float, 
	bo_oth float, 
	money float,
	oldmidmon float, 
	oldaward float, 
	adjustmoney float, 
	sugmoney float, 
	chkmoney float, 
	memo nvarchar(max),
	indate nvarchar(10),
	senior nvarchar(20)
) 
insert into @tmp 
select '0' gno,b.partno,b.part,b.sssno,b.namea,late,leaveearly,b.person,sick,leave,marriageleave,bereavementleave,greatmeriy,minormerits,commend,majordemerits,peccadillo,reprimand,salary,bo_admin,bo_traffic,bo_special,bo_oth,money,oldmidmon,oldaward,adjustmoney,sugmoney,chkmoney,memo2,c.indate,'' 
from salaward a left join salawards b on a.noa=b.noa left join sss c on b.sssno=c.noa  
where (a.year = @year) and (a.typea='秋節') and (b.sssno between @t_bsssno and @t_esssno) 
and (b.partno between @t_bpartno and @t_epartno) 

--年資 
--update @tmp 
--set senior = ( 
--case when (CAST(left(indate,3) as int)=0) then '未滿一月' else ( 
--case when (@year-CAST(left(indate,3) as int)-1) >0  and (12+9-CAST(right(left(indate,6),2) as int))=12 then cast((@year-CAST(left(indate,3) as int)) as nvarchar) + ' 年 '
--when (@year-CAST(left(indate,3) as int)-1) >0 then cast((@year-CAST(left(indate,3) as int)-1) as nvarchar) + ' 年 ' else '' end + 
--case when (9-CAST(right(left(indate,6),2) as int)) >0 then cast((9-CAST(right(left(indate,6),2) as int)) as nvarchar) + ' 月' 
--when (12+9-CAST(right(left(indate,6),2) as int))=12 then ''
--else cast((12+9-CAST(right(left(indate,6),2) as int)) as nvarchar) + ' 月' end ) 
--end) 

update a
set senior = isnull((select seniority from dbo.seniority('','') where sssno=a.sssno),'')
from @tmp a

insert into @tmp 
select '1','999','','','',SUM(late),SUM(early),SUM(person),SUM(sick),SUM(leave),SUM(marr),SUM(bereav)
,SUM(great),SUM(minor),SUM(commend),SUM(majorde),SUM(peccad),SUM(repri)
,SUM(salary),SUM(bo_admin),SUM(bo_traffic),SUM(bo_special),SUM(bo_oth),SUM(money),SUM(oldmidmon),SUM(oldaward),SUM(adjustmoney), SUM(sugmoney),SUM(chkmoney),'','','' 
from @tmp where gno = '0' 

insert into @tmp 
select '2',partno,part,'','',SUM(late),SUM(early),SUM(person),SUM(sick),SUM(leave),SUM(marr),SUM(bereav)
,SUM(great),SUM(minor),SUM(commend),SUM(majorde),SUM(peccad),SUM(repri)
,SUM(salary),SUM(bo_admin),SUM(bo_traffic),SUM(bo_special),SUM(bo_oth),SUM(money),SUM(oldmidmon),SUM(oldaward),SUM(adjustmoney), SUM(sugmoney),SUM(chkmoney),'','',''
from @tmp where gno = '0' group by partno,part 

select gno,idno,partno,part,sssno,namea,memo,indate,senior
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,late),1)),4,12)) late
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,early),1)),4,12)) early
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,person),1)),4,12)) person
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,sick),1)),4,12)) sick
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,leave),1)),4,12)) leave
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,marr),1)),4,12)) marr
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bereav),1)),4,12)) bereav
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,great),1)),4,12)) great
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,minor),1)),4,12)) minor
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,commend),1)),4,12)) commend
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,majorde),1)),4,12)) majorde
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,peccad),1)),4,12)) peccad
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,repri),1)),4,12)) repri
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,salary),1)),4,12)) salary
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bo_admin),1)),4,12)) bo_admin
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bo_traffic),1)),4,12)) bo_traffic
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bo_special),1)),4,12)) bo_special
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bo_oth),1)),4,12)) bo_oth
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,money),1)),4,12)) money
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldmidmon),1)),4,12)) oldmidmon 
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,oldaward),1)),4,12)) oldaward 
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,adjustmoney),1)),4,12)) adjustmoney 
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,sugmoney),1)),4,12)) sugmoney 
,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,chkmoney),1)),4,12)) chkmoney 
,(select worker from salaward where (year = @year) and (typea = '秋節'))worker 
from @tmp order by partno,gno;

 ------------------------------------------------------------------------------------------------------------------
 z_salaward9:--z_salaward9
declare @year nvarchar(10)
declare @t_bsssno nvarchar(20)
declare @t_esssno nvarchar(20)

set @year = case when '#non'=[2] then '' else [2] end
set @t_bsssno = case when '#non'=[3] then '' else [3] end
set @t_esssno = case when '#non'=[4] then char(255) else [4] end

select '0' gno,b.sssno,b.namea,b.partno,b.part,
b.late,b.leaveearly lea1,b.person,b.sick,b.leave lea2,b.marriageleave marry,b.bereavementleave bere,
b.greatmeriy great,b.minormerits minor,b.commend com,b.majordemerits major,b.peccadillo pecca,b.reprimand repri,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,b.chkmoney),1)),4,12)) chkmoney,b.memo2,a.worker
from salaward a left join salawards b on a.noa=b.noa
where a.year=@year and a.typea='秋節' and b.sssno between @t_bsssno and @t_esssno;

-------------------------------------------------------------------------------------------------
z_salaward10:--z_salaward10

declare @t_year nvarchar(10) 
set @t_year = case when '#non'=[2] then '' else [2] end

declare @tmp table( 
	gno nvarchar(1), 
	partno nvarchar(20), 
	part nvarchar(50), 
	oldmidmon float, 
	oldaward float, 
	adjustmoney float, 
	sugmoney float, 
	chkmoney float
) 

insert @tmp
select '0',b.partno,MAX(b.part),SUM(b.oldmidmon),SUM(b.oldaward),SUM(b.adjustmoney),SUM(b.sugmoney),SUM(b.chkmoney)
from salaward a left join salawards b on a.noa = b.noa 
where a.year=@t_year and a.typea='秋節'
group by b.partno

if((select count(*) from @tmp)>0)
begin
	insert @tmp
	select '1',CHAR(255),CHAR(255),SUM(oldmidmon),SUM(oldaward),SUM(adjustmoney),SUM(sugmoney),SUM(chkmoney)
	from @tmp 
end

select gno,partno,part, 
dbo.getComma(oldmidmon,0)oldmidmon,
dbo.getComma(oldaward,0)oldaward,
dbo.getComma(adjustmoney,0)adjustmoney,
dbo.getComma(sugmoney,0)sugmoney,
dbo.getComma(chkmoney,0)chkmoney,
(select worker from salaward where year = @t_year and typea='秋節') worker 
from @tmp order by gno,partno
;
-----------------------------------------------------------------------------------------------------------------------
z_salaward11:--z_salaward11
declare @t_year nvarchar(20) 
declare @t_order nvarchar(20)

set @t_year = case when '#non'=[2] then '' else [2] end
set @t_order = case when '#non' = [6] then '' else [6] end

declare @tmp table( 
	gno nvarchar(1), 
	noa nvarchar(30), 
	noq nvarchar(20), 
	sssno nvarchar(20), 
	partno nvarchar(20), 
	part nvarchar(50), 
	jobno nvarchar(20), 
	job nvarchar(50), 
	namea nvarchar(30), 
	account nvarchar(20), 
	total3 int,--現金 
	total4 int,--匯款 
	total5 int 
) 

	insert into @tmp 
	select '0' gno,a.noa,b.noq,c.noa,c.partno,c.part,c.jobno,c.job,b.namea,c.account,0,0,b.chkmoney 
	from salaward a 
	left join salawards b on a.noa = b.noa 
	left join sss c on b.sssno = c.noa 
	where a.year=@t_year and a.typea = '秋節'



--********************************************************************************* 

insert into @tmp 
select '1' gno,'','','','','','','','','',0,0,sum(total5) 
from @tmp 

update @tmp 
set total3=(select sum(total5) from @tmp where gno='0' and account='') 
where gno='1' 
update @tmp 
set total4=(select sum(total5) from @tmp where gno='0' and account!='') 
where gno='1' 

if(@t_order='職稱') 
select gno,noq,namea,account,sssno,part,job, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total3),1)),4,12)) total3, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total4),1)),4,12)) total4, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total5),1)),4,12)) total5, 
(select worker from salaward where year=@t_year and typea = '秋節') worker
from @tmp order by gno,partno,jobno 

if(@t_order='員工編號') 
select gno,noq,namea,account,sssno,part,job, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total3),1)),4,12)) total3, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total4),1)),4,12)) total4, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total5),1)),4,12)) total5, 
(select worker from salaward where year=@t_year and typea = '秋節') worker 
from @tmp order by gno,noa 

if(@t_order='帳號') 
select gno,noq,namea,account,sssno,part,job, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total3),1)),4,12)) total3, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total4),1)),4,12)) total4, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total5),1)),4,12)) total5, 
(select worker from salaward where year=@t_year and typea = '秋節') worker 
from @tmp order by gno,account 

if(@t_order='金額') 
select gno,noq,namea,account,sssno,part,job, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total3),1)),4,12)) total3, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total4),1)),4,12)) total4, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total5),1)),4,12)) total5, 
(select worker from salaward where year=@t_year and typea = '秋節') worker 
from @tmp order by gno,cast(total5 as int) desc;