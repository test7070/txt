z_jovcc01:--z_jovcc01
declare @t_bdate nvarchar(10) = case when '#non'=[3] then '' else [3] end
declare @t_edate nvarchar(10) = case when '#non'=[4] then char(255) else [4] end
declare @t_bcustno nvarchar(100) = case when '#non' =[6]  then '' else  [6]  end
declare @t_ecustno nvarchar(100) = case when '#non'=[7] then char(255) else [7] end
declare @tmp table(
	gno nvarchar(10),
	idno int,
	page int,
	pageno int,
	custno nvarchar(100),
	comp nvarchar(200),
	productno nvarchar(50),
	unit nvarchar(10),
	product nvarchar(250),
	size nvarchar(200),
	datea nvarchar(10),
	noa nvarchar(100),
	payterms nvarchar(20),
	coin nvarchar(10),
	price float,
	mount float)
declare @pageline int =20
declare @custno nvarchar(50) 
declare @idno int
declare @page int
--表頭
insert into @tmp(gno,custno,comp)
select '0',custno,comp
from view_ordes
where 
(odate between @t_bdate and @t_edate)
and (custno between @t_bcustno and @t_ecustno)
group by custno,comp
	
insert into @tmp(gno,custno,comp,productno,unit,product,size)
select '1',custno,comp,productno,unit,productno,spec
from  view_ordes
where 
(odate between @t_bdate and @t_edate)
and (custno between @t_bcustno and @t_ecustno)
group by custno,comp,productno,unit,productno,spec

insert into @tmp
select '2','','',ROW_NUMBER()over(partition by productno,unit,spec order by noa),custno,comp,productno,unit,productno,spec,datea,noa,payterms,acoin,price,mount
from  view_ordes
where custno between @t_bcustno  and @t_ecustno

update a
set idno=xidno,page=ceiling(cast(xidno as float)/@pageline)
from (select idno,page,row_number()over(partition by custno order by custno,productno,unit,size,noa) xidno from @tmp where gno!=0)a

insert @tmp(gno,custno,idno)
select '3',custno,9999
from @tmp
group by custno

select 
dbo.getComma(price,-1) price
,dbo.getComma(mount,0) mount
,* 
from @tmp
order by custno,idno
;
--------------------------------------------------------------------------------------------------------------------------------------------------------------
z_jovcc02:--z_jovcc02
declare @t_bcustno nvarchar(100) = case when '#non' =[3] then '' else [3] end
declare @t_ecustno nvarchar(100) = case when '#non' =[4] then char(255) else [4] end
	declare @tmp table(
		gno nvarchar(10),
		noa nvarchar(50),
		comp nvarchar(200),
		compen nvarchar(200),
		kdate nvarchar(10),
		nick nvarchar(100),
		salesno nvarchar(50),
		sales nvarchar(50),
		addr nvarchar(max),
		boss nvarchar(50),
		head nvarchar(50),
		email nvarchar(max),
		tel nvarchar(50),
		fax nvarchar(50),
		web nvarchar(max),
		typea nvarchar(50),
		country nvarchar(100),
		payterms nvarchar(50),
		getdatea nvarchar(10),
		namea nvarchar(50),
		job nvarchar(50),
		part nvarchar(50),
		memo nvarchar(max),
		serial nvarchar(50),
		invoicetitle nvarchar(100),
		addrinvo nvarchar(max),
		p23 nvarchar(10),
		shipmark nvarchar(max),
		sidemark nvarchar(max))
	insert @tmp (gno,noa,compen,comp,kdate,nick,salesno,sales,addr,boss,head,email,tel,fax,web,typea,country,payterms,getdatea)
	select '1',a.noa,SUBSTRING(comp,0,CHARINDEX('  ',comp)),SUBSTRING(comp,CHARINDEX('  ',comp)+1,LEN(comp)-CHARINDEX('  ',comp))
			,kdate,nick,salesno,sales,addr_comp,boss,head,email,tel,fax,web,typea,b.country,b.payterms,getdate
	from cust a left join custm b on a.noa=b.noa where a.noa between @t_bcustno and @t_ecustno
	
	insert @tmp(gno,noa,namea,job,part,memo)
	select '2',noa,namea,job,part,memo from conn where noa between @t_bcustno and @t_ecustno
	
	insert @tmp(gno,noa,nick,serial,invoicetitle,addrinvo,p23)
	select '3',a.noa,a.nick,b.serial,b.invoicetitle,b.addr_invo,c.p23
	from @tmp a left join cust b on a.noa=b.noa
	left join custm c on b.noa=c.noa where gno='1'
	
	insert @tmp(gno,noa,shipmark,sidemark,memo)
	select '4',custno,main,side,memo
	from ucam
	where custno between @t_bcustno and @t_ecustno
	
 	insert @tmp(gno,noa) select '5',noa from @tmp group by noa
	
select 
REPLACE(shipmark,'chr(10)','</br>') shipmark,
REPLACE(sidemark,'chr(10)','</br>') sidemark,
* 
from @tmp order by noa,gno
;
;
---------------------
z_jovcc03:--z_jovcc03
---------------------
z_jovcc04:--z_jovcc04
---------------------
z_jovcc05:--z_jovcc05--供應商交易歷史表
declare @t_bdate nvarchar(10) = case when '#non'=[3] then '' else [3] end
declare @t_edate nvarchar(10) = case when '#non'=[4] then char(255) else [4] end
declare @t_btggno nvarchar(100) = case when '#non' =[6]  then '' else  [6]  end
declare @t_etggno nvarchar(100) = case when '#non'=[7] then char(255) else [7] end
declare @tmp table(
	gno nvarchar(10),
	idno int,
	page int,
	pageno int,
	tggno nvarchar(100),
	comp nvarchar(200), 
	productno nvarchar(50),
	unit nvarchar(10),
	product nvarchar(250),
	size nvarchar(200),
	datea nvarchar(10),
	noa nvarchar(100),
	price float,
	mount float)
declare @pageline int =20
declare @tggno nvarchar(50) 
declare @idno int
declare @page int
--表頭
insert into @tmp(gno,tggno,comp)
select '0',tggno,comp
from view_ordcs
where 
(odate between @t_bdate and @t_edate)
and (tggno between @t_btggno and @t_etggno)
group by tggno,comp

insert into @tmp
select '1','','',ROW_NUMBER()over(partition by productno,unit,spec order by noa),tggno,comp,productno,unit,productno,spec,datea,noa,price,mount
from  view_ordcs
where tggno between @t_btggno  and @t_etggno

update a
set idno=xidno,page=ceiling(cast(xidno as float)/@pageline)
from (select idno,page,row_number()over(partition by tggno order by tggno,productno,unit,size,noa) xidno from @tmp where gno!=0)a

insert @tmp(gno,tggno,idno)
select '2',tggno,9999
from @tmp
group by tggno

select 
dbo.getComma(price,-1) price
,dbo.getComma(mount,0) mount
,* 
from @tmp
order by tggno,idno
;
--------------------------------------------------------------------------------------------------------------------------------------------------------------
z_jovcc06:--z_jovcc06 供應商基本資料
declare @t_btggno nvarchar(100) = case when '#non' =[3] then '' else [3] end
declare @t_etggno nvarchar(100) = case when '#non' =[4] then char(255) else [4] end 
	declare @tmp table(
		gno nvarchar(10),
		noa nvarchar(50),
		comp nvarchar(200),
		kdate nvarchar(10),
		nick nvarchar(100),
		sales nvarchar(50),
		addr nvarchar(max),
		boss nvarchar(50),
		email nvarchar(max),
		tel nvarchar(50),
		fax nvarchar(50),
		paytype nvarchar(30),
		getdatea nvarchar(10),
		addr_fact nvarchar(100),
		namea nvarchar(50),
		job nvarchar(50),
		part nvarchar(50),
		memo nvarchar(max))
	insert @tmp (gno,noa,comp,kdate,nick,sales,addr,boss,email,paytype,getdatea,tel,fax,addr_fact)
	select '1',noa,comp,kdate,nick,sales,addr_comp,boss,email,paytype,getdate,tel,fax,addr_fact
	from tgg where (noa between @t_btggno and @t_etggno)
	
	insert @tmp(gno,noa,namea,job,part,tel,memo)
	select '2',noa,namea,job,part,tel,memo 
	from conn where noa between @t_btggno and @t_etggno
	
	insert @tmp(gno,noa) 
	select '3',noa from @tmp group by noa
	select * from @tmp order by noa,gno
;
;
---------------------
z_jovcc07:--z_jovcc07
---------------------
z_jovcc08:--z_jovcc08廠商標籤
SET QUOTED_IDENTIFIER OFF
declare @cmd nvarchar(max)
declare @btggno nvarchar(max)
declare @etggno nvarchar(max)

set @btggno = case when '#non' =[3] then '' else [3] end
set @etggno = case when '#non' =[4] then char(255) else [4] end 

declare @tmp table(
	noa nvarchar(20),
	comp nvarchar(max),
	zip nvarchar(20),
	tel nvarchar(20),
	boss nvarchar(20),
	addr nvarchar(max)
)
set @cmd = " select noa,comp,zip_comp,addr_invo,tel,boss
             from tgg where (noa between @btggno and @etggno)"
insert into @tmp
execute sp_executesql @cmd,N'@btggno nvarchar(max),@etggno nvarchar(max)',@btggno=@btggno,@etggno=@etggno
select '1' gno,* from @tmp;

--select '1' gno,a.noa noa ,a.comp comp,a.boss boss,a.tel tel,a.zip_comp zip,a.addr_invo addr
--from tgg a where (a.noa between @btggno and @etggno) order by noa;

---------------------
z_jovcc09:--z_jovcc09
---------------------
z_jovcc10:--z_jovcc10 潛在客戶資料表
declare @t_bcustno nvarchar(100) = case when '#non' =[3] then '' else [3] end
declare @t_ecustno nvarchar(100) = case when '#non' =[4] then char(255) else [4] end
	declare @tmp table(
		gno nvarchar(10),
		noa nvarchar(50),
		comp nvarchar(200),
		compen nvarchar(200),
		kdate nvarchar(10),
		nick nvarchar(100),
		salesno nvarchar(50),
		sales nvarchar(50),
		addr nvarchar(max),
		boss nvarchar(50),
		head nvarchar(50),
		email nvarchar(max),
		tel nvarchar(50),
		fax nvarchar(50),
		web nvarchar(max),
		typea nvarchar(50),
		country nvarchar(100),
		payterms nvarchar(50),
		getdatea nvarchar(10),
		namea nvarchar(50),
		job nvarchar(50),
		part nvarchar(50),
		memo nvarchar(max),
		serial nvarchar(50),
		invoicetitle nvarchar(100),
		addrinvo nvarchar(max),
		p23 nvarchar(10),
		shipmark nvarchar(max),
		sidemark nvarchar(max))
	insert @tmp (gno,noa,compen,comp,kdate,nick,salesno,sales,addr,boss,head,email,tel,fax,web,typea,country,payterms,getdatea)
	select '1',a.noa,SUBSTRING(comp,0,CHARINDEX('  ',comp)),SUBSTRING(comp,CHARINDEX('  ',comp)+1,LEN(comp)-CHARINDEX('  ',comp))
			,kdate,nick,salesno,sales,addr_comp,boss,head,email,tel,fax,web,typea,b.country,b.payterms,getdate
	from cust a left join custm b on a.noa=b.noa where a.noa between @t_bcustno and @t_ecustno
	
	insert @tmp(gno,noa,namea,job,part,memo)
	select '2',noa,namea,job,part,memo from conn where noa between @t_bcustno and @t_ecustno
	
	insert @tmp(gno,noa,nick,serial,invoicetitle,addrinvo,p23)
	select '3',a.noa,a.nick,b.serial,b.invoicetitle,b.addr_invo,c.p23
	from @tmp a left join cust b on a.noa=b.noa
	left join custm c on b.noa=c.noa where gno='1'
	
	insert @tmp(gno,noa,shipmark,sidemark,memo)
	select '4',custno,main,side,memo
	from ucam
	where custno between @t_bcustno and @t_ecustno
	
	insert @tmp(gno,noa) select '5',noa from @tmp group by noa
	
select 
REPLACE(shipmark,'chr(10)','</br>') shipmark,
REPLACE(sidemark,'chr(10)','</br>') sidemark,
* 
from @tmp order by noa,gno
;
;
---------------------
z_jovcc11:--z_jovcc11
---------------------
z_jovcc12:--z_jovcc12
---------------------
z_jovcc13:--z_jovcc13
---------------------
z_jovcc14:--z_jovcc14產品大類描述表
declare @t_bno nvarchar(100) = case when '#non' =[3] then '' else [3] end
declare @t_eno nvarchar(100) = case when '#non' =[4] then char(255) else [4] end 
select '1' gno,a.noa noa ,a.namea namea
from uccga a where (a.noa between @t_bno and @t_eno) order by noa;
---------------------
z_jovcc15:--z_jovcc15產品銷售策略表
---------------------
z_jovcc16:--z_jovcc16產品基本資料表
declare @buccno nvarchar(100) = case when '#non' =[3] then '' else [3] end
declare @euccno nvarchar(100) = case when '#non' =[4] then char(255) else [4] end 
	declare @tmp table(
		gno nvarchar(10),
		noa nvarchar(50),
		product nvarchar(100),
		saleprice nvarchar(10),
		inprice nvarchar(10),
		unit nvarchar(10),
		spec nvarchar(100),
		tggno nvarchar(100),
		tgg nvarchar(100),
		groupano nvarchar(100)
		)
	insert @tmp (gno,noa,product,saleprice,inprice,unit,spec,tggno,tgg,groupano)
	select '1',noa,product,saleprice,inprice,unit,spec,tggno,tgg,groupano
	from ucc where (noa between @buccno and @euccno)
	
	insert @tmp(gno,noa) 
	select '2',noa from @tmp group by noa
	select * from @tmp order by noa,gno
;
;
---------------------
z_jovcc17:--z_jovcc17產品圖片資料表
---------------------
z_jovcc18:--z_jovcc18產品編號對照表
---------------------
z_jovcc19:--z_jovcc19產品簡要資料表
declare @buccno nvarchar(100) = case when '#non' =[3] then '' else [3] end
declare @euccno nvarchar(100) = case when '#non' =[4] then char(255) else [4] end 
select '1' gno,a.noa noa ,a.spec spec,a.product product,a.unit unit,a.saleprice saleprice,a.tggno tggno,a.tgg tgg
from ucc a where (a.noa between @buccno and @euccno) order by noa;